{{extend 'layout.html'}}

<h1>Edit Model Diagram for {{=model_name}}</h1>

<div class="row">
    <div class="col-6">
        {{=form.custom.begin}}
        {{=form.custom.submit}}
        {{=form.custom.widget.diagram}}
        <div class="model_form_comment">{{=form.custom.comment.diagram}}</div>
        {{=form.custom.end}}

        <button class="btn btn-secondary" onclick="setDefaultDot()">Use default dot code</button>
    </div>
    <div class="col-6 border-left">
        <div id="graph-container"></div>
    </div>
</div>


<script src="{{=URL('static','js/viz-global.js')}}"></script>

<script>

    const myTextarea = document.getElementById('model_diagram');
    myTextarea.addEventListener('input', (event) => {
        updateGraph();
    });

    function setDefaultDot() {
        document.getElementById("model_diagram").value = `{{=XML(default_dot)}}`;
        updateGraph();
    }

    function updateGraph() {

        Viz.instance().then(viz => {
            const svg = viz.renderSVGElement(document.getElementById("model_diagram").value);

            document.getElementById("graph-container").replaceChildren(svg);
        });
    }

    updateGraph();

</script>